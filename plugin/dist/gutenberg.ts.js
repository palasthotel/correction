(()=>{"use strict";const e=window.wp.element,t=window.wp.plugins,n=window.wp.editPost,r=window.wp.editor,l=window.wp.data,i=e=>{const t=(0,l.useDispatch)(r.store);return[(0,l.useSelect)((t=>t(r.store).getEditedPostAttribute(e)),[e]),n=>{t.editPost({[e]:n})}]},a=()=>{const[e,t]=i("corrections_messages");return[Array.isArray(e)?e:[],e=>{t(e)}]},o=()=>{const[e]=a();return e.filter((e=>0!==e.id))},s=window.wp.components,c=()=>window.Corrections.contentStructure,m=(new Intl.DateTimeFormat).resolvedOptions().locale,u=new Intl.DateTimeFormat(m,{year:"numeric",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1}),p=e=>u.format(e);function d({title:t="Requests",initialOpen:n=!1}){const m=c(),u=o(),d=(()=>{const e=o(),t={};return e.forEach((e=>{t[e.recipient]||(t[e.recipient]={...e,timestamp:0}),null!=e.sent_timestamp&&t[e.recipient].timestamp<e.sent_timestamp?t[e.recipient]={...e,timestamp:e.sent_timestamp}:null!=e.error_timestamp&&t[e.recipient].timestamp<e.error_timestamp&&(t[e.recipient]={...e,timestamp:e.error_timestamp})})),Object.values(t).sort(((e,t)=>t.timestamp-e.timestamp))})(),[g,h]=(()=>{const[e,t]=a(),n=e.filter((e=>0!==e.id));return[e.filter((e=>0==e.id)).map((e=>e.recipient)),e=>{t([...n,...e.map((e=>({id:0,recipient:e,modified_timestamp:Math.round(Date.now()/1e3),sent_timestamp:null,error_timestamp:null})))])}]})(),[E,w]=(()=>{const[e,t]=i("corrections_message_content");return(0,l.useDispatch)(r.store),[e,t]})(),y=!0===(0,l.useSelect)((e=>e(r.store).isSavingPost()||e(r.store).isPostSavingLocked()),[]),[k,b]=(0,e.useState)(!1),_=e=>t=>{w({...E,[e]:t})},v=window.Corrections.recipientSuggestionsConfig;return(0,e.createElement)(s.PanelBody,{title:t,initialOpen:n},m.map((t=>{var n,r,l;switch(t.type){case"text":return(0,e.createElement)(s.TextControl,{key:t.key,label:t.label,value:null!==(n=E[t.key])&&void 0!==n?n:t.defaultValue,onChange:_(t.key),help:t.help});case"textarea":return(0,e.createElement)(s.TextareaControl,{key:t.key,label:t.label,value:null!==(r=E[t.key])&&void 0!==r?r:t.defaultValue,onChange:_(t.key),help:t.help});case"toggle":return(0,e.createElement)(s.ToggleControl,{key:t.key,label:t.label,onChange:_(t.key),checked:null!==(l=E[t.key])&&void 0!==l?l:"1"==t.defaultValue,help:t.help})}return(0,e.createElement)("p",{key:t.key},"Unknown: ",t.label)})),(0,e.createElement)("hr",null),"autocomplete"==v.type?(0,e.createElement)(s.FormTokenField,{label:"Send correction request to",onChange:e=>{h(e)},suggestions:v.options,value:g,disabled:y}):null,"checkbox"==v.type?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h2",null,"Send correction request to"),v.options.map((t=>(0,e.createElement)(s.CheckboxControl,{key:t,label:t,checked:g.includes(t),disabled:y,onChange:e=>{h(e?[...g,t]:g.filter((e=>e!=t)))}})))):null,(0,e.createElement)("div",{style:{paddingBlockStart:8}},g.length?y?(0,e.createElement)(s.Spinner,null):"ðŸŸ ":"âšªï¸","Â ",(0,e.createElement)("i",null,g.length?y?"Sending requests...":"Save post to send requests.":"No recipients selected.")),(0,e.createElement)("hr",null),(0,e.createElement)("h2",null,k?"All requests":"Latest requests"),(k?u:d).map((t=>(0,e.createElement)("div",{key:t.id,style:{border:"1px solid var(--wp--preset--color--gray)",borderRadius:2,padding:10,marginBlock:5,wordWrap:"break-word"}},(0,e.createElement)("div",{style:{wordWrap:"break-word"}},t.recipient),t.sent_timestamp?(0,e.createElement)(e.Fragment,null,"âœ… ",(0,e.createElement)("i",null,p(1e3*t.sent_timestamp))):null,t.error_timestamp?(0,e.createElement)(e.Fragment,null,"ðŸš¨ ",(0,e.createElement)("i",null,p(1e3*t.error_timestamp))):null))),(0,e.createElement)("br",null),k?null:(0,e.createElement)(s.Button,{variant:"secondary",onClick:()=>{b(!0)}},"Show all requests"))}function g({title:t="Latest corrections",initialOpen:n=!0}){const i=(()=>{const e=(()=>{const e=(0,l.useSelect)((e=>e(r.store)),[]).getEditedPostAttribute("corrections_revisions");return Array.isArray(e)?e:[]})(),t={};return e.forEach((e=>{null==t[e.author_id]&&(t[e.author_id]={...e,count:0}),t[e.author_id].count++,t[e.author_id].timestamp<e.timestamp&&(t[e.author_id].timestamp=e.timestamp)})),Object.values(t).sort(((e,t)=>t.timestamp-e.timestamp))})();return(0,e.createElement)(s.PanelBody,{title:t,initialOpen:n},i.map((t=>(0,e.createElement)(s.PanelRow,{key:t.revision_post_id},(0,e.createElement)("div",null,t.author_name,(0,e.createElement)("br",null),(0,e.createElement)("i",null,p(1e3*t.timestamp)))))),(0,e.createElement)("br",null),(0,e.createElement)(s.Button,{href:window.Corrections.allRevisionsUrl,variant:"link"},"All revisions"))}const h="corrections-sidebar";(0,t.registerPlugin)("corrections-plugin",{render:()=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.PluginSidebarMoreMenuItem,{target:h,icon:"editor-spellcheck"},"Corrections"),(0,e.createElement)(n.PluginSidebar,{icon:"editor-spellcheck",name:h,title:"Corrections"},(0,e.createElement)(g,{initialOpen:!0}),(0,e.createElement)(d,{initialOpen:!1})))}),console.debug(c())})();