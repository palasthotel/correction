!function(){"use strict";var e=window.React,t=window.wp.plugins,n=window.wp.editPost,r=window.wp.editor,l=window.wp.data;const i=e=>{const t=(0,l.useDispatch)(r.store);return[(0,l.useSelect)((t=>t(r.store).getEditedPostAttribute(e)),[e]),n=>{t.editPost({[e]:n})}]},a=()=>{const[e,t]=i("corrections_messages");return[Array.isArray(e)?e:[],e=>{t(e)}]},o=()=>{const[e]=a();return e.filter((e=>0!==e.id))};var s=window.wp.components;function c({children:t}){return(0,e.createElement)("div",{style:{border:"1px solid var(--wp--preset--color--gray)",borderRadius:2,padding:10,marginBlock:5,marginInline:-10,wordWrap:"break-word"}},t)}const m=e=>{var t;return null!==(t=window.Corrections.i18n[e])&&void 0!==t?t:`? ${e} ?`},u=(new Intl.DateTimeFormat).resolvedOptions().locale,p=new Intl.DateTimeFormat(u,{year:"numeric",day:"numeric",month:"short",hour:"2-digit",minute:"2-digit",hour12:!1}),d=e=>p.format(e);var g=window.wp.element;function h({title:t=m("Requests"),initialOpen:n=!1}){const u=window.Corrections.contentStructure,p=o(),h=(()=>{const e=o(),t={};return e.forEach((e=>{t[e.recipient]||(t[e.recipient]={...e,timestamp:0}),null!=e.sent_timestamp&&t[e.recipient].timestamp<e.sent_timestamp?t[e.recipient]={...e,timestamp:e.sent_timestamp}:null!=e.error_timestamp&&t[e.recipient].timestamp<e.error_timestamp&&(t[e.recipient]={...e,timestamp:e.error_timestamp})})),Object.values(t).sort(((e,t)=>t.timestamp-e.timestamp))})(),[E,w]=(()=>{const[e,t]=a(),n=e.filter((e=>0!==e.id));return[e.filter((e=>0==e.id)).map((e=>e.recipient)),e=>{t([...n,...e.map((e=>({id:0,recipient:e,modified_timestamp:Math.round(Date.now()/1e3),sent_timestamp:null,error_timestamp:null})))])}]})(),[y,k]=(()=>{const[e,t]=i("corrections_message_content");return(0,l.useDispatch)(r.store),[e,t]})(),v=!0===(0,l.useSelect)((e=>e(r.store).isSavingPost()||e(r.store).isPostSavingLocked()),[]),[b,_]=(0,g.useState)(!1),C=e=>t=>{k({...y,[e]:t})},f=window.Corrections.recipientSuggestionsConfig;return(0,e.createElement)(s.PanelBody,{title:t,initialOpen:n},u.map((t=>{var n,r,l;switch(t.type){case"text":return(0,e.createElement)(s.TextControl,{key:t.key,label:t.label,value:null!==(n=y[t.key])&&void 0!==n?n:t.defaultValue,onChange:C(t.key),help:t.help});case"textarea":return(0,e.createElement)(s.TextareaControl,{key:t.key,label:t.label,value:null!==(r=y[t.key])&&void 0!==r?r:t.defaultValue,onChange:C(t.key),help:t.help});case"toggle":return(0,e.createElement)(s.ToggleControl,{key:t.key,label:t.label,onChange:C(t.key),checked:null!==(l=y[t.key])&&void 0!==l?l:"1"==t.defaultValue,help:t.help})}return(0,e.createElement)("p",{key:t.key},"Unknown: ",t.label)})),(0,e.createElement)("hr",null),"autocomplete"==f.type?(0,e.createElement)(s.FormTokenField,{label:m("Send correction request to"),onChange:e=>{w(e)},suggestions:f.options,value:E,disabled:v}):null,"checkbox"==f.type?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("h2",null,m("Send correction request to")),f.options.map((t=>(0,e.createElement)(s.CheckboxControl,{key:t,label:t,checked:E.includes(t),disabled:v,onChange:e=>{w(e?[...E,t]:E.filter((e=>e!=t)))}})))):null,(0,e.createElement)("div",{style:{paddingBlockStart:8}},E.length?v?(0,e.createElement)(s.Spinner,null):"🟠":"⚪️"," ",(0,e.createElement)("i",null,E.length?m(v?"Sending requests...":"Save post to send requests."):m("No recipients selected."))),(0,e.createElement)("hr",null),(0,e.createElement)("h2",null,m(b?"All requests":"Latest requests")),(b?p:h).map((t=>(0,e.createElement)(c,{key:t.id},(0,e.createElement)("div",{style:{wordWrap:"break-word"}},t.recipient),t.sent_timestamp?(0,e.createElement)(e.Fragment,null,"✅ ",(0,e.createElement)("i",null,d(1e3*t.sent_timestamp))):null,t.error_timestamp?(0,e.createElement)(e.Fragment,null,"🚨 ",(0,e.createElement)("i",null,d(1e3*t.error_timestamp))):null))),0==p.length?(0,e.createElement)("p",null,(0,e.createElement)("i",null,m("No request yet."))):null,!b&&p.length>h.length?(0,e.createElement)(e.Fragment,null,(0,e.createElement)("br",null),(0,e.createElement)(s.Button,{variant:"secondary",onClick:()=>{_(!0)}},m("Show all requests"))):null)}function E({title:t=m("Latest corrections"),initialOpen:n=!0}){const i=(()=>{const e=(()=>{const e=(0,l.useSelect)((e=>e(r.store)),[]).getEditedPostAttribute("corrections_revisions");return Array.isArray(e)?e:[]})(),t={};return e.forEach((e=>{null==t[e.author_id]&&(t[e.author_id]={...e,count:0}),t[e.author_id].count++,t[e.author_id].timestamp<e.timestamp&&(t[e.author_id].timestamp=e.timestamp)})),Object.values(t).sort(((e,t)=>t.timestamp-e.timestamp))})();return(0,e.createElement)(s.PanelBody,{title:t,initialOpen:n},i.map((t=>(0,e.createElement)(c,{key:t.revision_post_id},t.author_name,(0,e.createElement)("br",null),(0,e.createElement)("i",null,d(1e3*t.timestamp))))),(0,e.createElement)("br",null),(0,e.createElement)(s.Button,{href:window.Corrections.allRevisionsUrl,variant:"link"},m("All revisions")))}const w="corrections-sidebar";(0,t.registerPlugin)("corrections-plugin",{render:()=>(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.PluginSidebarMoreMenuItem,{target:w,icon:"editor-spellcheck"},m("Corrections")),(0,e.createElement)(n.PluginSidebar,{icon:"editor-spellcheck",name:w,title:m("Corrections")},(0,e.createElement)(E,{initialOpen:!0}),(0,e.createElement)(h,{initialOpen:!1})))})}();